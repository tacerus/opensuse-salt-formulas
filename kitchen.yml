---
driver:
  name: docker
  hostname: lorem.test-infra.opensuse.org
  is_file_root: true
  use_sudo: false
  privileged: true
  run_options:
    tmpfs:
      - /tmp
      - /run
      - /run/lock
    cgroup-parent: docker.slice
    cgroupns: private
    security-opt: seccomp=unconfined
    cap-add:
        - SYS_ADMIN

provisioner:
  name: salt_solo
  salt_install: false
  require_chef: false
  log_level: info
  state_top:
    base:
      '*':
        - grains
  pillars:
    top.sls:
      base:
        '*':
          - grains_pillar
  grains:
    integration_test: true

platforms:
  - name: openSUSE-Tumbleweed
    driver_config:
#      image: registry.opensuse.org/home/crameleon/containers/containers/crameleon/salt:latest
      image: registry.opensuse.org/isv/suseinfra/containers/containerfile/suseinfra/salt-dev:latest
      platform: opensuse
      run_command: /usr/lib/systemd/systemd

suites:
  - name: grains-default-inspec
    provisioner:
      pillars-from-files:
        grains_pillar.sls: grains-formula/test/pillar/default.sls
      collection_name: grains
      state_collection: grains-formula/grains
    verifier:
      name: inspec
      inspec_tests:
        - grains-formula/test/integration/default
  - name: grains-default-testinfra
    provisioner:
      pillars-from-files:
        grains_pillar.sls: grains-formula/test/pillar/default.sls
      collection_name: grains
      state_collection: grains-formula/grains
    verifier:
      name: shell
      command: pytest --color=yes --hosts="paramiko://${KITCHEN_USERNAME}@${KITCHEN_HOSTNAME}:${KITCHEN_PORT}?ssh_identity_file=${KITCHEN_SSH_KEY}" grains-formula/test/integration-py/default.py
